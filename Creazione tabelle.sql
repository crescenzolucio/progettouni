CREATE TABLE ATTORI(
	ID_ATTORE VARCHAR(6) PRIMARY KEY,
	NOMINATIVO VARCHAR(50) NOT NULL,
	NAZIONALITA VARCHAR(20) NOT NULL,
	DATA_NASCITA DATE NOT NULL
);

CREATE TABLE REGISTI(
	ID_REGISTA VARCHAR(6) PRIMARY KEY,
	NOMINATIVO VARCHAR(50) NOT NULL,
	NAZIONALITA VARCHAR(20) NOT NULL,
	DATA_NASCITA DATE NOT NULL
);

CREATE TABLE FILM(
	ID_FILM VARCHAR(6) PRIMARY KEY,
	TITOLO VARCHAR(50) NOT NULL,
	ANNO_PRODUZIONE VARCHAR(4) NOT NULL,
	ID_REGISTA VARCHAR(6),
	DURATAMIN SMALLINT NOT NULL ,
	
	CONSTRAINT CHECKDURATAMAX CHECK (DURATAMIN >=0 AND DURATAMIN <=1440),
	CONSTRAINT CHECKANNO  CHECK  (CAST(ANNO_PRODUZIONE AS INTEGER) between 1895 and date_part('year', CURRENT_DATE)),
	CONSTRAINT FK_REGISTA FOREIGN KEY(ID_REGISTA) REFERENCES REGISTI(ID_REGISTA)
);

CREATE TABLE ATTORI_FILM(
	ID_ATTORE VARCHAR(6),
	ID_FILM  VARCHAR(8),
	
	CONSTRAINT FK_ATTOREFILM FOREIGN KEY(ID_ATTORE) REFERENCES ATTORI(ID_ATTORE),
	CONSTRAINT FK_FILMATTORE FOREIGN KEY(ID_FILM) REFERENCES FILM(ID_FILM)
);

CREATE TABLE SALE(
	ID_SALA VARCHAR(3) PRIMARY KEY,
	DESCRIZIONE VARCHAR(20) NOT NULL,
	CINEMA3D BOOLEAN DEFAULT 'false',
	SOUND_SYSTEM VARCHAR(20),
	RISOLUZIONE VARCHAR(20),
	TECNOLOGIA VARCHAR(20),
	POSTI SMALLINT NOT NULL
);

CREATE TABLE PROIEZIONI(
	ID_PROIEZIONE VARCHAR(8) PRIMARY KEY,
	ID_SALA VARCHAR(3),
	ID_FILM  VARCHAR(8),
	DATA_PROIEZIONE DATE NOT NULL,
	INIZIO_PROIEZIONE TIME NOT NULL,
	FINE_PROIEZIONE TIME NOT NULL,
	
	CONSTRAINT FK_SALA FOREIGN KEY(ID_SALA) REFERENCES SALE(ID_SALA),
	CONSTRAINT FK_FILM FOREIGN KEY(ID_FILM) REFERENCES FILM(ID_FILM)
);

CREATE TABLE BIGLIETTI(
	ID_PROIEZIONE VARCHAR(8),
	ID_BIGLIETTO SERIAL PRIMARY KEY,
	PREZZO DECIMAL NOT NULL,
	SCONTO SMALLINT, 
	PREZZOFINALE DECIMAL NOT NULL,
	CONSTRAINT FK_SALA FOREIGN KEY(ID_PROIEZIONE) REFERENCES PROIEZIONI(ID_PROIEZIONE)
);

CREATE TABLE SOUND_SYSTEM(
	ID_SOUND SERIAL PRIMARY KEY,
	ANNO varchar(4),
	NOME varchar(50)
);